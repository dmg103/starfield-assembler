ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 
                              2 .globl cpct_memset_asm
   0000                       3 m_entities: .ds 50
   0032                       4 m_next_free_entity: .ds 2
                              5 
   0034 0A                    6 max_entities: .db 10
                              7 
   0035 00 00                 8 m_function_given_forall: .dw #0x0000
   0037 38 40                 9 m_test_delete: .dw #0x4038
                             10 
                             11 ;;Creates an entitiy coping zeros in their values
                             12 ;;Intialize the pointer of the next free entity.
                             13 ;;Changes de, a, bc, hl
   0039                      14 man_entity_init::
                             15 
                             16     ;;Filling up with zeros
   0039 11 00 00      [10]   17     ld de, #m_entities
   003C 3E 00         [ 7]   18     ld a, #0x00
   003E 01 32 00      [10]   19     ld bc, #50
                             20 
   0041 CD 00 00      [17]   21     call cpct_memset_asm
                             22     
                             23     ;;Next free entity should point towards m_entities
   0044 21 00 00      [10]   24     ld hl, #m_entities
   0047 22 32 00      [16]   25     ld (m_next_free_entity), hl
   004A C9            [10]   26 ret
                             27     
                             28 ;;Charges into de the next free entity memory direction
                             29 ;;Changes de, bc, hl
   004B                      30 man_entity_create::
                             31     ;;Saving the next free memory direction of m_entities into de
   004B ED 5B 32 00   [20]   32     ld de, (m_next_free_entity)
                             33 
   004F 01 05 00      [10]   34     ld bc, #0x0005
   0052 2A 32 00      [16]   35     ld hl, (m_next_free_entity)
                             36     
   0055 09            [11]   37     add hl, bc
   0056 22 32 00      [16]   38     ld (m_next_free_entity), hl
   0059 C9            [10]   39 ret
                             40 
                             41 ;;Prerequirements
                             42 ;;      -DE should have the memory direction for the function given
                             43 ;;Changes a, hl, de
   005A                      44 man_entity_forall::
   005A 21 00 00      [10]   45     ld hl, #m_entities
                             46     ;;Keeping the function adress in a variable to use it.
   005D ED 53 35 00   [20]   47     ld (m_function_given_forall), de
                             48 
   0061 ED 5B 34 00   [20]   49     ld de, (#max_entities)
   0065 16 00         [ 7]   50     ld d, #0x00
   0067                      51         repeat_man_entity_forall:
                             52         ;;Compare against type to know if we should continue looping
   0067 7E            [ 7]   53         ld a, (hl)
   0068 C6 00         [ 7]   54         add a, #0x00 
   006A 28 0C         [12]   55         jr z, entity_no_valid
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



                             56 
                             57         ;;Call the funcion given registered in m_function_given_forall
   006C CD 37 00      [17]   58         call (#m_test_delete)
                             59 
                             60         ;;Add 5 to hl to move to the next entitysys_physics_update_one_entity
   006F 3E 05         [ 7]   61         ld a, #0x05
   0071                      62             repeat_inc_hl:
   0071 23            [ 6]   63             inc hl
   0072 3D            [ 4]   64             dec a
   0073 20 FC         [12]   65         jr nz, repeat_inc_hl
                             66 
                             67         ;;Decrement a to loop among the entities
   0075 1D            [ 4]   68         dec e
   0076 20 EF         [12]   69     jr nz, repeat_man_entity_forall
   0078                      70     entity_no_valid:
   0078 C9            [10]   71 ret
                             72 
