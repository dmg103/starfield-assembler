ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 1.
Hexadecimal [16-Bits]



                              1 .globl man_entity_forall
                              2 .globl cpct_getScreenPtr_asm
                              3 
                              4 ;;Prerequirements:
                              5 ;;  Hl should have a pointer to the memory direction of the entity
                              6 ;;Changes a, b, c 
   0000                       7 sys_render_one_entity:
   0000 3E 05         [ 7]    8     ld a, #0x05
   0002                       9         inc_hl:
   0002 23            [ 6]   10         inc hl
   0003 3D            [ 4]   11         dec a
   0004 20 FC         [12]   12     jr nz, inc_hl
                             13 
                             14     ;;After inc hl five times, we are in the prevptr memory position
   0006 4E            [ 7]   15     ld c, (hl)
   0007 3E 00         [ 7]   16     ld a, #0x00
   0009 91            [ 4]   17     sub c
   000A 28 09         [12]   18     jr z, preptr_0 
                             19 
   000C 7E            [ 7]   20     ld a, (hl)
   000D 4F            [ 4]   21     ld c, a
                             22     
   000E 23            [ 6]   23     inc hl 
                             24 
   000F 7E            [ 7]   25     ld a, (hl)
   0010 47            [ 4]   26     ld b, a
                             27 
   0011 3E 00         [ 7]   28     ld a, #0x00
   0013 02            [ 7]   29     ld (bc), a
                             30 
   0014 2B            [ 6]   31     dec hl
                             32 
   0015                      33     preptr_0:
                             34 
                             35     ;;Hl is now pointing to the prevptr of the entity
   0015 3E 05         [ 7]   36     ld a, #0x05
   0017                      37         dec_hl:
   0017 2B            [ 6]   38         dec hl
   0018 3D            [ 4]   39         dec a
   0019 20 FC         [12]   40     jr nz, dec_hl
                             41 
                             42     ;;Hl is now pointing towards the type of the entity
   001B 7E            [ 7]   43     ld a, (hl)
   001C 0E 80         [ 7]   44     ld c, #0x80
   001E A1            [ 4]   45     and c
   001F 20 1F         [12]   46     jr nz, and_no_zero
                             47 
   0021 E5            [11]   48     push hl
                             49 
   0022 11 00 C0      [10]   50     ld de, #0xC000
   0025 23            [ 6]   51     inc hl
   0026 4E            [ 7]   52     ld c, (hl)
   0027 23            [ 6]   53     inc hl
   0028 46            [ 7]   54     ld b, (hl)
                             55 
ASxxxx Assembler V02.00 + NoICE + SDCC mods  (Zilog Z80 / Hitachi HD64180), page 2.
Hexadecimal [16-Bits]



   0029 CD 00 00      [17]   56     call cpct_getScreenPtr_asm
                             57 
   002C 36 88         [10]   58     ld (hl), #0x88
                             59 
                             60     ;;Bc contains now the pointer to x and y in the screen memory
   002E 44            [ 4]   61     ld b, h
   002F 4D            [ 4]   62     ld c, l
                             63 
   0030 E1            [10]   64     pop hl
                             65 
                             66     ;;After the pop hl is still pointing towards the type of the entity
   0031 3E 05         [ 7]   67     ld a, #0x05
   0033                      68         final_inc_hl:
   0033 23            [ 6]   69         inc hl
   0034 3D            [ 4]   70         dec a
   0035 20 FC         [12]   71     jr nz, final_inc_hl
                             72 
   0037 71            [ 7]   73     ld (hl), c
   0038 23            [ 6]   74     inc hl
   0039 70            [ 7]   75     ld (hl), b
                             76 
   003A 3E 06         [ 7]   77     ld a, #0x06
   003C                      78         final_dec_hl:
   003C 2B            [ 6]   79         dec hl
   003D 3D            [ 4]   80         dec a
   003E 20 FC         [12]   81     jr nz, final_dec_hl
                             82     
                             83     ;;After this hl is still pointing to the entity
                             84 
   0040                      85     and_no_zero:
   0040 C9            [10]   86 ret
                             87 
   0041                      88 sys_render_update::
   0041 11 00 00      [10]   89     ld de, #sys_render_one_entity
   0044 CD 00 00      [17]   90     call man_entity_forall
   0047 C9            [10]   91 ret
